# 技术栈选型文档

## 设计原则

> **最简单但最健壮** = 最少的依赖 + 最成熟的方案 + 最低的维护成本

---

## 推荐方案：Python 轮询服务

### 为什么选择 Python？

| 优势 | 说明 |
|------|------|
| ✅ 生态成熟 | Bitget 官方 SDK、飞书 SDK 都有 Python 版本 |
| ✅ 部署简单 | 单文件即可运行，无需编译 |
| ✅ 调试方便 | 脚本语言，快速迭代 |
| ✅ 学习成本低 | 代码易读易维护 |

---

## 核心依赖（仅 4 个）

```txt
pybitget          # Bitget 官方 Python SDK
lark-oapi         # 飞书官方 Python SDK
python-dotenv     # 环境变量管理
schedule          # 轻量级定时任务（可选，也可用 time.sleep）
```

> [!TIP]
> 总共只需要 **4 个依赖**，没有数据库、没有消息队列、没有 Web 框架

---

## 数据存储方案对比

| 方案 | 复杂度 | 推荐度 | 说明 |
|------|--------|--------|------|
| **JSON 文件** | ⭐ | ✅ 推荐 | 简单直接，够用 |
| SQLite | ⭐⭐ | 可选 | 需要复杂查询时使用 |
| Redis | ⭐⭐⭐ | ❌ | 过度设计 |
| PostgreSQL | ⭐⭐⭐⭐ | ❌ | 完全没必要 |

**结论**：使用 **JSON 文件** 存储同步状态，足够健壮且零运维

---

## 运行方式对比

| 方案 | 复杂度 | 推荐度 | 说明 |
|------|--------|--------|------|
| **直接运行 Python** | ⭐ | ✅ 本地测试 | `python main.py` |
| **systemd 服务** | ⭐⭐ | ✅ Linux 服务器 | 自动重启、开机启动 |
| **Docker 容器** | ⭐⭐ | ✅ 跨平台部署 | 隔离环境 |
| PM2 | ⭐⭐ | 可选 | Node.js 生态，也能管理 Python |
| Kubernetes | ⭐⭐⭐⭐⭐ | ❌ | 严重过度设计 |

---

## 同步策略对比

| 方案 | 实时性 | 复杂度 | 推荐度 |
|------|--------|--------|--------|
| **轮询 (Polling)** | 30秒延迟 | ⭐ | ✅ 推荐 |
| WebSocket 推送 | 实时 | ⭐⭐⭐ | ❌ 增加复杂度 |
| Webhook 回调 | 实时 | ⭐⭐⭐⭐ | ❌ 需要公网服务器 |

**结论**：交易日志不需要毫秒级实时性，**30秒轮询** 完全够用

---

## 最终技术架构

```
┌─────────────────────────────────────────────────────────┐
│                    Python 单进程服务                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  pybitget   │  │  lark-oapi  │  │  state.json │     │
│  │  (API调用)   │  │  (API调用)   │  │  (状态存储)  │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
         │                   │
         ▼                   ▼
    ┌─────────┐        ┌───────────┐
    │ Bitget  │        │ 飞书多维表格 │
    └─────────┘        └───────────┘
```

---

## 项目文件结构

```
trade/
├── main.py              # 主入口（<100行）
├── bitget_client.py     # Bitget API 封装（<50行）
├── feishu_client.py     # 飞书 API 封装（<80行）
├── state.json           # 同步状态（自动生成）
├── .env                 # 配置文件
└── requirements.txt     # 依赖清单（4行）
```

> [!IMPORTANT]
> 整个项目预计 **不超过 300 行代码**

---

## 备选方案（不推荐）

| 方案 | 不推荐原因 |
|------|-----------|
| Node.js | Bitget SDK 不如 Python 成熟 |
| Go | 开发效率低，过度工程化 |
| Serverless (云函数) | 冷启动延迟、调试困难 |
| Zapier/n8n | 付费、灵活性差 |

---

## 总结

| 维度 | 选型 |
|------|------|
| **语言** | Python 3.10+ |
| **框架** | 无（纯脚本） |
| **存储** | JSON 文件 |
| **同步** | 30秒轮询 |
| **部署** | 直接运行 / Docker |
| **依赖数** | 4 个 |
| **代码量** | < 300 行 |

> [!TIP]
> 这是能完成需求的**最简方案**，没有任何多余组件
