# Bitget 交易日志自动同步系统 - 设计文档

## 1. 项目概述

构建一个半自动化的交易日志系统，自动同步 Bitget 交易数据到飞书多维表格。

### 核心目标
- **开仓时**：自动记录开仓价格、币种名称
- **平仓时**：自动记录平均卖出价、收益、平均成本
- **手动填写**：跟单员名称

---

## 2. 系统架构

```
┌─────────────┐    API轮询    ┌──────────────┐    API写入    ┌─────────────┐
│   Bitget    │ ──────────► │  同步服务     │ ──────────► │  飞书多维表格 │
│   交易所    │              │  (Python)    │              │             │
└─────────────┘              └──────────────┘              └─────────────┘
```

---

## 3. 飞书多维表格字段设计

| 字段名称 | 类型 | 来源 | 说明 |
|---------|------|------|------|
| 币种名称 | 文本 | 自动 | 交易对名称 (如 BTCUSDT) |
| 开仓时间 | 日期 | 自动 | 首次开仓时间 |
| 开仓价格 | 数字 | 自动 | 平均开仓价 |
| 开仓数量 | 数字 | 自动 | 开仓总数量 |
| 方向 | 单选 | 自动 | 多/空 |
| 平仓时间 | 日期 | 自动 | 仓位清零时间 |
| 平仓价格 | 数字 | 自动 | 平均卖出价 |
| 收益(USDT) | 数字 | 自动 | 已实现盈亏 |
| 收益率 | 数字 | 自动 | 百分比收益 |
| 跟单员 | 文本 | **手动** | 用户自行填写 |
| 备注 | 文本 | 手动 | 交易备注 |

---

## 4. 技术方案

> 详细技术栈选型请参阅 [tech-stack.md](file:///Volumes/T7/program/trade/tech-stack.md)

### API 集成

| 平台 | API 用途 |
|------|---------|
| Bitget REST API | 获取持仓、订单历史、已实现盈亏 |
| 飞书开放平台 API | 写入/更新多维表格记录 |

---

## 5. 所需凭据

| 凭据 | 来源 |
|------|------|
| `BITGET_API_KEY` | Bitget API 管理页面 |
| `BITGET_SECRET_KEY` | Bitget API 管理页面 |
| `BITGET_PASSPHRASE` | Bitget API 管理页面 |
| `FEISHU_APP_ID` | 飞书开放平台 |
| `FEISHU_APP_SECRET` | 飞书开放平台 |
| `FEISHU_TABLE_ID` | 多维表格 URL 中获取 |

---

## 6. 项目结构

```
trade/
├── main.py              # 主入口
├── bitget_client.py     # Bitget API 封装
├── feishu_client.py     # 飞书 API 封装
├── sync_service.py      # 同步逻辑
├── state.json           # 本地状态存储
├── .env                 # 环境变量配置
└── requirements.txt     # 依赖
```

---

## 7. 开发计划

| 阶段 | 任务 | 预计时间 |
|------|------|---------|
| 1 | Bitget API 对接 | 1天 |
| 2 | 飞书多维表格 API 对接 | 1天 |
| 3 | 同步逻辑开发 | 1天 |
| 4 | 测试与调优 | 1天 |

---

## 8. 注意事项

> [!IMPORTANT]
> - Bitget API 需开启**只读**或**交易**权限
> - 飞书应用需开启**多维表格**权限并添加到目标文档

> [!TIP]
> - 建议使用 Bitget 的模拟盘进行测试
> - 可部署到服务器 24 小时运行
